<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Employee Department Distribution — Single-file</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#ffffff;--muted:#555;--card:#f6f8fa}
    body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;line-height:1.45;background:var(--bg);color:#111;margin:24px}
    .container{max-width:960px;margin:0 auto}
    header{display:flex;align-items:baseline;gap:12px}
    h1{margin:0;font-size:1.5rem}
    .meta{color:var(--muted);font-size:0.95rem}
    .card{background:var(--card);padding:14px;border-radius:10px;margin-top:14px}
    img.plot{width:100%;height:auto;border-radius:8px;border:1px solid #e6e9ee}
    pre.code{background:#fff;padding:12px;border-radius:8px;border:1px solid #eceff3;overflow:auto}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{background:#0b5fff;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:#6b7280}
    small{color:var(--muted)}
    footer{margin-top:20px;color:var(--muted);font-size:0.9rem}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Employee Department Distribution — Single-file HTML</h1>
    </header>
    <p class="meta">Standalone file with embedded base64 chart image and downloadable Python script. Verification email: <strong>22f3001685@ds.study.iitm.ac.in</strong></p>

    <div class="card">
      <h2 style="margin-top:0">Histogram (embedded as base64)</h2>
      <p style="margin:6px 0">This page builds a simple department-count histogram and embeds it as a base64 image (SVG encoded). You can change the synthetic data below and regenerate.</p>

      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <label class="meta">Number of employees: <input id="nEmployees" type="number" value="100" min="10" style="width:80px;margin-left:8px"></label>
        <label class="meta">Seed: <input id="seed" type="number" value="42" style="width:80px;margin-left:8px"></label>
        <div class="controls">
          <button id="regen">Regenerate &amp; Embed Image</button>
          <button class="secondary" id="downloadPy">Download Python script</button>
          <button class="secondary" id="copyHtml">Copy HTML to clipboard</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <img id="plotImg" class="plot" alt="Department distribution (base64-embedded SVG)" src="" />
      </div>

      <h3 style="margin-top:18px">Python script (downloadable)</h3>
      <p class="meta">The button "Download Python script" saves a ready-to-run script that reproduces the synthetic dataset and saves <code>department_distribution.png</code>. The script content is shown below for review.</p>
      <pre id="pyCode" class="code"></pre>
    </div>

    <footer>
      Generated with guidance from ChatGPT · Verification: <strong>22f3001685@ds.study.iitm.ac.in</strong>
    </footer>
  </div>

  <script>
  // --- Utilities ---
  function seededRandom(seed) {
    // simple LCG
    let state = seed >>> 0;
    return function() {
      state = (1664525 * state + 1013904223) >>> 0;
      return state / 4294967296;
    }
  }

  function sampleWeighted(items, weights, rand) {
    const total = weights.reduce((a,b)=>a+b,0);
    const r = rand() * total;
    let cum = 0;
    for (let i=0;i<items.length;i++){
      cum += weights[i];
      if (r <= cum) return items[i];
    }
    return items[items.length-1];
  }

  // --- Data & SVG generation ---
  const departments = ["Sales","Marketing","Operations","R&D","IT","HR","Finance"];
  const deptWeights = [20,15,15,10,12,8,20];

  function generateData(n=100, seed=42){
    const rand = seededRandom(Number(seed));
    const counts = Object.fromEntries(departments.map(d=>[d,0]));
    for (let i=0;i<n;i++){
      const d = sampleWeighted(departments, deptWeights, rand);
      counts[d] += 1;
    }
    return counts;
  }

  function makeSVG(counts){
    const labels = Object.keys(counts);
    const values = labels.map(l=>counts[l]);
    const maxV = Math.max(...values,1);
    const w = 900, h = 360, pad = 36;
    const barW = (w - pad*2) / labels.length * 0.8;
    const gap = ((w - pad*2) - barW*labels.length) / (labels.length - 1 || 1);

    const barElems = labels.map((lab,i)=>{
      const x = pad + i*(barW+gap);
      const hBar = (values[i]/maxV) * (h - pad*2);
      const y = h - pad - hBar;
      return `<g>
        <rect x="${x.toFixed(1)}" y="${y.toFixed(1)}" width="${barW.toFixed(1)}" height="${hBar.toFixed(1)}" rx="6" fill="#0b5fff" fill-opacity="0.85" />
        <text x="${(x+barW/2).toFixed(1)}" y="${(y-8).toFixed(1)}" font-size="12" text-anchor="middle" fill="#111">${values[i]}</text>
        <text x="${(x+barW/2).toFixed(1)}" y="${(h-pad+16).toFixed(1)}" font-size="12" text-anchor="middle" fill="#111">${lab}</text>
      </g>`;
    }).join('\n');

    const title = `<text x="${pad}" y="20" font-size="16" fill="#111">Department Distribution (n=${values.reduce((a,b)=>a+b,0)})</text>`;

    const svg = `<?xml version="1.0" encoding="UTF-8"?>\n`+
      `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'>\n`+
      `<defs><style>text{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}</style></defs>\n`+
      `<rect width='100%' height='100%' fill='white'/>\n`+
      `${title}\n`+
      `${barElems}\n`+
      `</svg>`;
    return svg;
  }

  function svgToDataUrl(svg){
    // use base64 encoding for portability
    return 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svg)));
  }

  // --- Python script content (string) ---
  const pythonScript = `# employee_viz_full.py\n# Verification email: 22f3001685@ds.study.iitm.ac.in\n# Generates a synthetic employee dataset, prints IT frequency, and saves a histogram PNG.\n\nimport random\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nrandom.seed(42)\ndepartments = ["Sales","Marketing","Operations","R&D","IT","HR","Finance"]\nregions = ["Europe","Latin America","North America","Asia Pacific","Africa"]\nrows = []\nfor i in range(1, 101):\n    emp_id = f"EMP{i:03d}"\n    dept = random.choices(departments, weights=[20,15,15,10,12,8,20], k=1)[0]\n    region = random.choice(regions)\n    perf = round(random.uniform(60, 95) + (5 if dept == "R&D" else 0), 2)\n    years = random.randint(1, 20)\n    sat = round(random.uniform(2.5, 5.0), 1)\n    rows.append([emp_id, dept, region, perf, years, sat])\n\ndf = pd.DataFrame(rows, columns=["employee_id","department","region","performance_score","years_experience","satisfaction_rating"])\n\nit_count = (df["department"] == "IT").sum()\nprint(f'Frequency count for the "IT" department: {it_count}')\n\ndf.to_csv("employee_data_sample.csv", index=False)\n\nfig, ax = plt.subplots(figsize=(10,6))\ndept_counts = df["department"].value_counts().sort_index()\nax.bar(dept_counts.index, dept_counts.values)\nax.set_title("Department Distribution (n=100)")\nax.set_xlabel("Department")\nax.set_ylabel("Count")\nfor p in ax.patches:\n    ax.annotate(int(p.get_height()), (p.get_x()+p.get_width()/2., p.get_height()), ha='center', va='bottom')\nplt.tight_layout()\nplt.savefig("department_distribution.png", bbox_inches='tight')\nprint('Saved plot to department_distribution.png')\n`;

  // --- DOM binding & actions ---
  const plotImg = document.getElementById('plotImg');
  const pyCodeEl = document.getElementById('pyCode');
  const regenBtn = document.getElementById('regen');
  const downloadBtn = document.getElementById('downloadPy');
  const copyHtmlBtn = document.getElementById('copyHtml');

  function render(){
    const n = Number(document.getElementById('nEmployees').value) || 100;
    const seed = Number(document.getElementById('seed').value) || 42;
    const counts = generateData(n, seed);
    const svg = makeSVG(counts);
    const dataUrl = svgToDataUrl(svg);
    plotImg.src = dataUrl; // embedded base64 image
    // Update Python code shown (keeps the verification email)
    pyCodeEl.textContent = pythonScript;
  }

  regenBtn.addEventListener('click', ()=>{
    render();
  });

  downloadBtn.addEventListener('click', ()=>{
    const blob = new Blob([pythonScript], {type: 'text/x-python'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'employee_viz_full.py';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  copyHtmlBtn.addEventListener('click', async ()=>{
    // copy outerHTML of the whole document
    try{
      const html = '<!doctype html>\n' + document.documentElement.outerHTML;
      await navigator.clipboard.writeText(html);
      copyHtmlBtn.textContent = 'Copied!';
      setTimeout(()=> copyHtmlBtn.textContent = 'Copy HTML to clipboard', 1500);
    }catch(e){
      alert('Copy failed — your browser may restrict clipboard access.');
    }
  });

  // initial render
  render();
  </script>
</body>
</html>
